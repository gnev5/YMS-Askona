# КРИТИЧЕСКИ ВАЖНО: Работа с базой данных

⚠️ **ВАЖНО**: В проекте установлена последняя версия Docker с встроенным Compose. Всегда использовать синтаксис `docker compose` (без тире), а не `docker-compose`.

⚠️ НИКОГДА не выполнять команды, которые удаляют данные БД без явного подтверждения пользователя:
- `rebuild_database.py` - УДАЛЯЕТ ВСЕ ДАННЫЕ
- `docker volume rm` - УДАЛЯЕТ ВСЕ ДАННЫЕ
- Любые DROP TABLE/DATABASE команды

## Правила работы с БД:

1. При проблемах с авторизацией/миграцией - СНАЧАЛА спросить пользователя
2. Для обновлений использовать миграции Alembic, НЕ пересоздание БД
3. Если нужно изменить схему хэширования - использовать множественные схемы для обратной совместимости
4. rebuild_database.py использовать ТОЛЬКО на пустых/тестовых окружениях

## Безопасный процесс обновления:

1. `git pull` - загрузить изменения
2. `docker compose build` - пересобрать образы
3. `docker compose up -d` - перезапустить контейнеры
4. Миграции БД применятся автоматически при старте

## Примеры правильных команд:

```bash
# Правильно: обновление с сохранением данных
git pull
docker compose build --no-cache
docker compose up -d

# Правильно: миграции через Alembic
docker compose exec backend alembic upgrade head

# НЕПРАВИЛЬНО: удаляет все данные
python rebuild_database.py
docker volume rm yms-askona_db_data
```

## Когда можно использовать rebuild_database.py:

- Только на пустых/тестовых окружениях
- Только после явного подтверждения пользователя
- Только если нет других способов восстановить работоспособность

## Проверка состояния БД:

```bash
# Проверить статус контейнеров
docker compose ps

# Посмотреть логи
docker compose logs db
docker compose logs backend

# Подключиться к БД
docker compose exec db psql -U yms -d yms